:title: Django, Redmine both on the same vhost in apache
:date: 2010-02-17

.. raw:: html

    I've spent a good portion of my day messing with this, asking questions in various channels on irc.freenode.net, and generally trying to not let my head explode.<br /><br />What 'this' is exactly is this:<br /><br />I wanted my django app to run on / of my domain. Since I don't own my domain it would be easiest(or so I thought) to setup redmine on /redmine of my domain. This way it is only one domain and I can run my bug/project tracker on the same place as my website.<br /><br /><a href="http://synput.thruhere.net/">http://synput.thruhere.net</a><br /><a href="http://synput.thruhere.net/redmine">http://synput.thruhere.net/redmine</a><br /><br />That shows that I have it all working, now how did I do it... It will be simple for you but was not a simple process for me due to a couple settings I had tweaked without realizing the effect.<br /><br />First off lets get the django app setup, I use mod_wsgi for my django apps, and run them in daemon mode so I can easily update the app without taking down the server at all.<br /><br />My wsgi file (should look pretty typical for those who have seen one before):<br /><pre class="brush: python">import os<br />import sys<br /><br />root_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))<br />sys.path.append(root_dir)<br /><br />os.environ['DJANGO_SETTINGS_MODULE'] = 'recipes.settings'<br /><br />import django.core.handlers.wsgi<br />application = django.core.handlers.wsgi.WSGIHandler()</pre>You'll need to toss <br /><pre>LoadModule wsgi_module modules/mod_wsgi.so</pre>into your httpd.conf<br /><br />Here is my vhost stuff without the Redmine stuff in it:<br /><pre class="brush: xml">&lt;virtualhost 80=""&gt;<br />ServerName synput.thruhere.net<br />ServerAdmin xwraithanx@gmail.com<br /><br />Alias /media /srv/wsgi/recipes/media<br /><br />&lt;directory srv="" wsgi="" recipes="" media=""&gt;<br />Order allow,deny<br />Options Indexes FollowSymlinks<br />Allow from all<br />&lt;/directory&gt;<br /><br />WSGIDaemonProcess recipes python-path=/srv/wsgi/recipes/lib/python2.6/site-packages display-name=%{GROUP}<br />WSGIProcessGroup recipes<br />WSGIScriptAlias / /srv/wsgi/recipes/recipes.wsgi<br /><br />&lt;directory srv="" wsgi="" recipes=""&gt;<br />Order deny,allow<br />Allow from all<br />&lt;/directory&gt;<br />&lt;/virtualhost&gt;</pre>So far this should look pretty typical for anyone who has ever setup a django vhost with apache.<br /><br />Now for Redmine I chose to use Phusion, why you might ask? Well sycopomp uses it and when I asked him why, because he found a guide somewhere that made it easy and his memory usage isn't very high. So basically, not for any good reason.<br /><br />Go ahead and symlink your redmine/public directory into your DocumentRoot for me that was /srv/http.<br /><br />You'll have to install Phusion:<br /><pre class="brush: bash">gem install passenger<br />passenger-install-apache2-module</pre>That will toss up a helpful wizard to do the installation for you with a couple of prompts. You will need to copy the lines from the wizard into your httpd.conf, they should look something like:<br /><pre class="brush: xml">LoadModule passenger_module /usr/lib/ruby/gems/1.9.1/gems/passenger-2.2.9/ext/apache2/mod_passenger.so<br />PassengerRoot /usr/lib/ruby/gems/1.9.1/gems/passenger-2.2.9<br />PassengerRuby /usr/bin/ruby</pre>Next we need to add a line to our vhost and change another one, first line we'll add tells the server where to find and put redmine:<br /><pre class="brush: xml">RailsBaseURI /redmine</pre>And secondly we need to change out:<br /><pre class="brush: xml">WSGIScriptAlias / /srv/wsgi/recipes/recipes.wsgi</pre>Add put in the following instead since that will make django not catch /redmine:<br /><pre class="brush: xml">WSGIScriptAliasMatch ^\/(?!redmine(.*)) /srv/wsgi/recipes/recipes.wsgi</pre>Restart the server and we should be good.<br /><br />I didn't make this page/code as generic as I could have but hopefully you can get the meaning from it, if not the kind folks in #httpd on irc.freenode.net can help you. They'll understand this if you don't. Also, do what some like to call frobbing, play with it, break it, whatever it takes so you understand it.